@page "/kalender"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using ReMindHealth.Components.Layout
@rendermode InteractiveServer
@layout AppLayout

<div class="app-frame">
    <div class="home-container">
        <div class="header-with-back">
            <button class="zurueck-wrapper" @onclick='() => NavigateTo("/dashboard")'>
                <img src="images/zurueck.png" alt="ZurÃ¼ck" class="zurueck-button" />
            </button>
            <h2 class="greeting">
                <i class="bi bi-calendar3"></i> Termine
            </h2>
        </div>

        @if (isLoading)
        {
            <div class="loading-state">
                <p>Lade Termine...</p>
            </div>
        }
        else if (termine == null || !termine.Any())
        {
            <div class="no-appointments">
                <p>Es wurden noch keine Termine eingetragen</p>
                <button class="primary-button" @onclick='() => NavigateTo("/record")'>
                    Termin aufnehmen
                </button>
            </div>
        }
        else
        {
            <div class="termin-list">
                @foreach (var termin in termine)
                {
                    <div class="termin-item @(selectedTermin?.AppointmentId == termin.AppointmentId ? "active" : "")"
                         @onclick="() => SelectTermin(termin)">
                        <div class="termin-date">
                            @termin.AppointmentDateTime.ToLocalTime().ToString("dddd dd. MMM", new System.Globalization.CultureInfo("de-DE"))
                        </div>
                        <div class="termin-time">
                            @termin.AppointmentDateTime.ToLocalTime().ToString("HH:mm")
                        </div>
                    </div>
                }
            </div>

            @if (selectedTermin != null)
            {
                <div class="termin-detail">
                    @if (string.IsNullOrWhiteSpace(selectedTermin.Title))
                    {
                        <div class="no-info">
                            <i class="bi bi-plus-square-fill"></i>
                            <p>Es wurden noch keine Informationen zu dem Termin eingetragen</p>
                        </div>
                    }
                    else
                    {
                        <div class="termin-info">
                            <i class="bi bi-calendar-check-fill"></i>
                            <h4>@selectedTermin.Title</h4>
                            <p class="termin-zeit">
                                <i class="bi bi-clock"></i>
                                @selectedTermin.AppointmentDateTime.ToLocalTime().ToString("HH:mm")
                            </p>
                            @if (!string.IsNullOrEmpty(selectedTermin.Location))
                            {
                                <p class="termin-adresse">
                                    <i class="bi bi-geo-alt"></i>
                                    @selectedTermin.Location
                                </p>
                            }
                            @if (!string.IsNullOrEmpty(selectedTermin.Description))
                            {
                                <p class="termin-beschreibung">
                                    @selectedTermin.Description
                                </p>
                            }
                            @if (!string.IsNullOrEmpty(selectedTermin.AttendeeNames))
                            {
                                <p class="termin-teilnehmer">
                                    <i class="bi bi-people"></i>
                                    @selectedTermin.AttendeeNames
                                </p>
                            }
                            @if (selectedTermin.DurationMinutes.HasValue)
                            {
                                <p class="termin-dauer">
                                    <i class="bi bi-hourglass"></i>
                                    @selectedTermin.DurationMinutes Minuten
                                </p>
                            }
                        </div>
                    }
                </div>
            }
        }
    </div>
</div>