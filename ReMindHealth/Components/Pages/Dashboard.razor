@page "/dashboard"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using ReMindHealth.Components.Layout
@rendermode InteractiveServer
@layout AppLayout
<div class="app-frame">
    <div class="home-container">
        <h2 class="greeting">@greeting</h2>

        <!-- Grid mit 4 Features -->
        <div class="button-grid">
            <div class="feature-card" @onclick="@(() => NavigateTo("/Record"))">
               <img src="images/aufnahmen.png" alt="Aufnahmen" class="feature-icon" />
                <p>Aufnahmen</p>
            </div>
            <div class="feature-card" @onclick="@(() => NavigateTo("/Search"))">
                <img src="images/krankheiten_suchen.png" alt="Krankheiten suchen" class="feature-icon" />
                <p>Krankheiten<br />suchen</p>
            </div>
            <div class="feature-card" @onclick="@(() => NavigateTo("/Kalender"))">
                <img src="images/kalender.png" alt="Termine" class="feature-icon" />
                <p>Termine</p>
            </div>
            <div class="feature-card" @onclick="@(() => NavigateTo("/Summaries"))">
                <img src="images/zusammenfassung.png" alt="Zusammenfassungen" class="feature-icon" />
                <p>Zusammenfassungen</p>
            </div>
        </div>

        <!-- Letzte Zusammenfassungen -->
        <div class="summary-section">
            <h3>Letzte Zusammenfassungen</h3>

            @if (isLoading)
            {
                <div class="loading-state">
                    <p>Lade Zusammenfassungen...</p>
                </div>
            }
            else if (!recentConversations.Any())
            {
                <div class="no-summaries">
                    <p>Noch keine Zusammenfassungen vorhanden.</p>
                    <p>Erstellen Sie Ihre erste Aufnahme!</p>
                </div>
            }
            else
            {
                @foreach (var conversation in recentConversations)
                {
                    <div class="summary-card">
                        <img src="images/brain.png" alt="Icon" class="summary-icon" />
                        <div class="summary-info">
                            <p class="summary-title">@conversation.Title</p>
                            <p class="summary-date">@conversation.RecordedAt.ToLocalTime().ToString("dd MMM yyyy")</p>
                            @if (!string.IsNullOrEmpty(conversation.Summary))
                            {
                                <p class="summary-preview">@(conversation.Summary.Length > 80 ? conversation.Summary.Substring(0, 80) + "..." : conversation.Summary)</p>
                            }
                        </div>
                        <span class="summary-arrow">›</span>
                    </div>
                }
            }
        </div>
    </div>
</div>
